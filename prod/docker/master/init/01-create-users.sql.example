-- ============================================
-- Master DB 초기화 스크립트
-- 복제 및 MaxScale 사용자 생성
-- ============================================

-- 복제 사용자 생성 (Slave → Master 연결용)
CREATE USER IF NOT EXISTS 'repl_user'@'%' IDENTIFIED BY 'CHANGE_THIS_REPLICATION_PASSWORD';
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'%';

-- MaxScale 모니터 사용자 (서버 상태 모니터링)
CREATE USER IF NOT EXISTS 'maxscale_monitor'@'%' IDENTIFIED BY 'CHANGE_THIS_MONITOR_PASSWORD';
GRANT REPLICATION CLIENT, REPLICATION SLAVE ON *.* TO 'maxscale_monitor'@'%';
GRANT SLAVE MONITOR ON *.* TO 'maxscale_monitor'@'%';
GRANT SELECT ON mysql.user TO 'maxscale_monitor'@'%';
GRANT SELECT ON mysql.db TO 'maxscale_monitor'@'%';
GRANT SELECT ON mysql.tables_priv TO 'maxscale_monitor'@'%';
GRANT SELECT ON mysql.columns_priv TO 'maxscale_monitor'@'%';
GRANT SELECT ON mysql.procs_priv TO 'maxscale_monitor'@'%';
GRANT SELECT ON mysql.proxies_priv TO 'maxscale_monitor'@'%';
GRANT SELECT ON mysql.roles_mapping TO 'maxscale_monitor'@'%';
GRANT SHOW DATABASES ON *.* TO 'maxscale_monitor'@'%';

-- MaxScale 라우터 사용자 (쿼리 라우팅)
CREATE USER IF NOT EXISTS 'maxscale_router'@'%' IDENTIFIED BY 'CHANGE_THIS_ROUTER_PASSWORD';
GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO 'maxscale_router'@'%';

-- 권한 적용
FLUSH PRIVILEGES;
